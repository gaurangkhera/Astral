{% extends 'base.html' %}
{% block content %}
<body class="relative h-screen bg-gradient-to-b from-blue-50 to-blue-100">
  <div class="max-w-4xl px-4 py-10 sm:px-6 lg:px-8 lg:py-14 mx-auto">
    <!-- Title -->
    <div class="text-center">
      <svg class="w-28 h-auto mx-auto mb-4" width="116" height="32" viewBox="0 0 116 32" fill="none" xmlns="http://www.w3.org/2000/svg">
        <!-- Your SVG Path Here -->
      </svg>

      <h1 class="text-3xl font-bold text-gray-800 sm:text-4xl dark:text-white">
        Welcome to Preline AI
      </h1>
      <p class="mt-3 text-gray-600 dark:text-gray-400">
        Your AI-powered copilot for the web
      </p>
    </div>
    <!-- End Title -->

    <ul id="message-container" class="mt-16 space-y-5 overflow-y-auto max-h-[calc(100vh-350px)]">
      <!-- Messages will be dynamically loaded here using Jinja -->
      {% for message in messages %}
        {% if message.role == 'user' %}
          <li class="flex justify-end gap-x-2 sm:gap-x-4">
            <div class="bg-blue-600 text-white rounded-lg p-4 inline-block">
              {{ message.content }}
            </div>
          </li>
        {% else %}
          <li class="flex justify-start gap-x-2 sm:gap-x-4">
            <div class="bg-gray-200 text-gray-700 rounded-lg p-4 inline-block">
              {{ message.content }}
            </div>
          </li>
        {% endif %}
      {% endfor %}
    </ul>

    <form id="question-form" class="flex mb-4">
      <input type="text" id="user-question" placeholder="Ask me anything..." class="flex-1 p-2 border border-gray-300 rounded-l outline-none focus:border-blue-500">
      <button type="submit" class="bg-blue-500 text-white px-4 rounded-r">Ask</button>
    </form>
  </div>
</body>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  $(document).ready(function() {
    function scrollToBottom() {
      $('#message-container').scrollTop($('#message-container')[0].scrollHeight);
    }

    scrollToBottom();

    $('#question-form').submit(function(event) {
      event.preventDefault();
      let userQuestion = $('#user-question').val();
      let userMessage = `
        <li class="flex justify-end gap-x-2 sm:gap-x-4">
          <div class="bg-blue-600 text-white rounded-lg p-4 inline-block">
            ${userQuestion}
          </div>
        </li>`;

      $('#message-container').append(userMessage);
      $('#user-question').val('');
      scrollToBottom();

      $.ajax({
        type: 'POST',
        url: '/ask_question',
        data: { user_question: userQuestion },
        success: function(data) {
          let aiMessage = `
            <li class="flex justify-start gap-x-2 sm:gap-x-4">
              <div class="bg-gray-200 text-gray-700 rounded-lg p-4 inline-block">
                ${data['response']}
              </div>
            </li>`;

          $('#message-container').append(aiMessage);
          scrollToBottom();
        },
        error: function() {
          let aiErrorMessage = `
            <li class="flex justify-start gap-x-2 sm:gap-x-4">
              <div class="bg-gray-200 text-gray-700 rounded-lg p-4 inline-block">
                Error: Something went wrong.
              </div>
            </li>`;

          $('#message-container').append(aiErrorMessage);
          scrollToBottom();
        }
      });
    });
  });
</script>
{% endblock content %}
